# Physics-contrained Machine learning Model for Evapotranspiration

Please contact me and quote my article in your writting if you want to use my code to complete your project!

The hybrid model consists of two main components: a machine learning module for simulating surface resistance (rs) or aerodynamic resistance (ra), and a physical model (Penman Monteith or Surface Energy Balance model) for predicting LE.

We developed our hybrid models using Python. Similar to machine learning models, the dataset was partitioned into training (70%) and validation (20%) sets to dynamically update the internal model parameters during the fitting process. The test set (10%) was then used to assess the performance of the physics-constrained hybrid models. 

We employed three machine learning (ML) approaches — Artificial Neural Network (ANN), Random Forest (RF), and Light Gradient Boosting Machine (LGBM) — to develop both data-driven and physics-constrained ET models. These ML approaches with different characteristics and complexity, have been widely applied in the carbon and water cycle modeling for terrestrial ecosystems. ANN simulates human neural networks by adjusting synaptic weights through backpropagation, allowing it to learn intricate data patterns. RF, as an ensemble method of decision trees, builds each tree from randomized subsets and averages predictions for enhanced accuracy. LGBM, an optimized gradient boosting method, uses a leaf-wise strategy for tree expansion, supported by efficient sampling techniques, to improve model accuracy and training speed.

After reviewing the required model attributes for regional ET algorithms, we utilized two classical models: the Penman Monteith model and surface energy balance model.The Penman Monteith (PM) model has been successfully applied to the MODIS global ET framework, which eliminates land surface temperature and utilizes remotely sensed vegetation indices to inform the model of the water availability on the land surface. More details are provided in [MOD16](https://github.com/arthur-e/MOD16). The surface energy balance (SEB) model calculates the flux of sensible heat by calculating the aerodynamic resistance (ra). More reference can be found [here](https://github.com/jvdkwast/PySEBS).

In the Penman Monteith (PM) approach, surface resistance (rs) governs the water vapor and energy exchange between the ground surface and the atmosphere. rs is controlled by the joint effect of meteorological, soil, and vegetation factors. Numerous studies have showed that rs is a primary source of uncertainty in PM-based estimations.In the surface energy balance (SEB) model, aerodynamic resistance (ra) is the most sensitive parameter, as it captures the turbulent exchange between the land surface and the atmosphere. Traditionally, ra has been parameterized as a function of surface roughness, vegetation, and soil variables, with considerable variability across climates and surface types. However, the determination of these atmospheric boundary layer parameters is quite complex and difficult, thus lead to errors in ra estimation.  we employed machine learning models to predict rs and ra, and subsequently incorporated the predicted rs or ra into the PM and SEB method to estimate LE. The resulting model is referred to as the ML_PM or ML_SEB hybrid model.

The hybrid model in this study consists of two main components: a machine learning module for simulating rs or ra, and a physical model for predicting LE. The introduction of the machine learning component adds computational cost compared to the physical model. The training time of the RF and LGBM models is relatively fast (within 10 minutes). The fitting process of the ANN requires a relatively longer training time (about 30 minutes), mainly due to the adjustment of synaptic weights through backpropagation. However, we implemented an early stopping strategy to minimize computational resource waste and prevent overfitting. As machine learning is less dependent on specific hardware, the hybrid model remains competitive, offering high prediction accuracy with only a slight increase in computational cost, thus providing excellent cost-effectiveness. The hardware platform used in the experiments consists of a 32-core CPU and 64GB system memory. During training, the average CPU and memory utilization were 30% and 50%, respectively.

Here is the structure of the hybrid models, and additional details are provided in the accompanying code.

## Hybrid Models Structure
![Hybrid_ANN](https://github.com/user-attachments/assets/f8115f26-63c8-44aa-98d9-0e7fa1a937ec)
![Hybrid_RF](https://github.com/user-attachments/assets/de44546a-5c3c-4a35-a70b-aaa5b2142c57)
![Hybrid_LGBM](https://github.com/user-attachments/assets/1c8f8494-4db5-45c8-ab81-cfc6987dd52a)
